import{pxratio as t,animate as i,TAU as s,frame as n,getcanvas as h,fill as e,stroke as o,circle as a,rect as r,shape as c,vertex as p,CLOSE as d,looping as l,stop as u,loop as f}from"https://unpkg.com/bratik@0.5.3/lib/bratik.es.js";import m from"https://unpkg.com/simplex-noise@3.0.1/dist/esm/simplex-noise.js";import g from"../dist/round-polygon.es.js";const x=new m;class w{static count=0;id;num;radius;scale;width;height;min;points;rounded;draw;ctx;dur;updater;pr;clip;constructor(s,n,h,e,o,a,r){this.id=w.count,this.num=n,this.pr=t(),this.radius=h*this.pr,this.scale=e,this.width=o*this.pr,this.height=a*this.pr,this.min=Math.min(o,a)*this.scale,this.ctx=s,this.draw=()=>{},this.color("black"),this.clip=new Path2D,this.getpoint=this.getpoint.bind(this),this.init=this.init.bind(this),this.points=Array(this.num).fill(null).map((()=>{const t=1.5*this.rndangle();return{a:t,x:this.width/2/this.pr+Math.cos(t)*this.min/2,y:this.height/2/this.pr+Math.sin(t)*this.min/2}})),this.rounded=g(this.points,this.radius),this.dur=r,this.updater=i({dur:this.dur,ease:"cubicInOut",ontick:()=>{this.points.forEach((t=>{t.x=this.width/2/this.pr+Math.cos(t.a)*this.min/2,t.y=this.height/2/this.pr+Math.sin(t.a)*this.min/2})),this.rounded=g(this.points,this.radius)},onend:this.init}),w.count++}init(){const t=this.points.map((({a:t})=>({a:(t+this.rndangle())%s})));this.updater.on(this.points,t)}color(t){this.draw=()=>{this.ctx.save(),this.clippolio(),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore()}}gradient(){const t=y(3,((t,i)=>y(this.height/50/(i+1)*(i+1)|0,Math.random))).reverse(),i=w.count%2==1;this.draw=()=>{this.ctx.save(),this.clippolio(),t.forEach(((s,h)=>{const e=this.ctx.createLinearGradient(0,0,i?0:this.width,i?this.height:0);s.forEach((o=>{const a=function(t,i){return(x.noise2D(t,i)+1)/2}(n*s.length/5555,o*this.height),r=i?a*a*a:1-a*a*a,c=255*r,p=255*r,d=255*r,l=1-h/t.length;e.addColorStop(o,`rgba(${c},${p},${d},${l})`)})),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.width,this.height)})),this.ctx.restore()}}rndangle=()=>(Math.random()-.5)*s*4/3;getpoint(){return{x:Math.random()*this.width,y:Math.random()*this.height}}clippolio(){const t=this.pr;this.clip=new Path2D,this.rounded.forEach(((i,s)=>{!s&&this.clip.moveTo(i.in.x*t,i.in.y*t),i.angle.main>3e-4&&this.clip.arcTo(i.x*t,i.y*t,i.next.x*t,i.next.y*t,i.arc.radius*t),this.clip.lineTo(i.next.in.x*t,i.next.in.y*t)})),this.ctx.clip(this.clip)}}function y(t,i){return"[object Function]"===Object.prototype.toString.call(i)?Array(t).fill(null).map(i):Array(t).fill(i)}const{ctx:b,canvas:M,height:E,width:k}=h(),v=Number.MAX_SAFE_INTEGER,S=Math.min(k,E),j=1.25,A=["#7fa","#a7f","#fa7"],T=new w(b,9,v,j,k,E,8e3);T.gradient(),T.init();const $=new w(b,7,v,1,k,E,8e3);$.gradient();const D=new w(b,4,v,.75,k,E,8e3);function R(){160===n&&$.init(),320===n&&D.init(),e("black"),r(0,0,k,E),e(null),o("#fff4",.5),a(k/2,E/2,S/2*j),T.draw(),F(T.points,"#555"),e(null),o("#fff4",.5),a(k/2,E/2,S/2*j*.8),$.draw(),function(t,i){o(i,1),e(null),c(),t.forEach((t=>p(t.x,t.y))),c(d)}($.points,"#fff4"),F($.points,"#aaa"),e(null),o("#fff4",.5),a(k/2,E/2,S/2*j*.6),D.draw(),F(D.points,A[0])}function F(t,i){o(null),e(i),t.forEach((t=>a(t.x,t.y,3)))}D.color(A[0]);const G=()=>{l?(u(),T.updater.pause(),$.updater.pause(),D.updater.pause()):(f(R),T.updater.paused&&T.updater.play(),$.updater.paused&&$.updater.play(),D.updater.paused&&D.updater.play())};M.onpointerdown=window.onkeydown=t=>{(t instanceof KeyboardEvent&&"Space"===t.code||t instanceof MouseEvent&&0===t.button)&&G()},document.onvisibilitychange=G,f(R);
