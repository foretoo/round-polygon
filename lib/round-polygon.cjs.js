"use strict";const o=(e,n)=>Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)),d=(e,n,g)=>{if(g){const l=o(e,n),t=o(n,g),a=o(g,e);return Math.acos((l*l+t*t-a*a)/(2*l*t))}else return Math.atan2(n.y-e.y,n.x-e.x)},v=Math.PI,k=v*2,c=(e,n)=>{const g=n-e;return g>v&&g<k||g<0&&g>-v?-1:1},m=(e,n,g)=>{const l=d(e,n,g),t=d(n,e),a=d(n,g),s=1/Math.tan(l/2),h=c(t,a),f=t+h*l/2;return{main:l,next:a,prev:t,vel:s,dir:h,bis:f}};let i;const y=(e,n)=>{i=e.length;const g=e.map((t,a)=>{const s=e[(a-1+e.length)%e.length],h=e[(a+1)%e.length],f=o(t,h),x=o(s,t),M=m(s,t,h);return{...t,angle:M,offset:0,arc:{radius:n,hit:n},in:{length:x,rest:x},out:{length:f,rest:f},locked:!1,id:a,get prev(){return g[(a-1+e.length)%e.length]},get next(){return g[(a+1)%e.length]}}});for(g.forEach(t=>{t.arc.hit=Math.min(t.out.length/(t.angle.vel+t.next.angle.vel),t.in.length/(t.angle.vel+t.prev.angle.vel))});i;)g.sort(_),P(g[0],g,n);g.sort((t,a)=>t.id-a.id);const l=g.map((t,a)=>{const s=t.arc.radius/Math.sin(t.angle.main/2),h=t.arc.radius*t.angle.vel;return{x:t.x,y:t.y,angle:t.angle,offset:h,arc:{radius:t.arc.radius,x:t.x+Math.cos(t.angle.bis)*s,y:t.y+Math.sin(t.angle.bis)*s},in:{length:t.in.length,x:t.x+Math.cos(t.angle.prev)*h,y:t.y+Math.sin(t.angle.prev)*h},out:{length:t.out.length,x:t.x+Math.cos(t.angle.next)*h,y:t.y+Math.sin(t.angle.next)*h},id:a,get prev(){return l[(a-1+e.length)%e.length]},get next(){return l[(a+1)%e.length]}}});return l},P=(e,n,g)=>{if(!e.locked){const l=n.find(a=>a.id===(e.id-1+n.length)%n.length),t=n.find(a=>a.id===(e.id+1)%n.length);if(g>=e.arc.hit)if(e.arc.hit===t.arc.hit){const a=n.find(f=>f.id===(l.id-1+n.length)%n.length),s=n.find(f=>f.id===(t.id+1)%n.length),h=n.find(f=>f.id===(s.id+1)%n.length);e.arc.radius=e.arc.hit,t.arc.radius=e.arc.hit,t.locked=!0,e.locked=!0,i-=2,e.offset=e.arc.radius*e.angle.vel,t.offset=t.arc.radius*t.angle.vel,s.in.rest-=t.offset,t.out.rest-=t.offset,t.in.rest-=t.offset,t.in.rest-=e.offset,e.out.rest-=e.offset,e.in.rest-=e.offset,l.out.rest-=e.offset,s.arc.hit=Math.min(s.out.length/(s.angle.vel+h.angle.vel),s.in.rest/s.angle.vel),l.arc.hit=Math.min(l.in.length/(l.angle.vel+a.angle.vel),l.out.rest/l.angle.vel)}else if(e.arc.hit===l.arc.hit){const a=n.find(f=>f.id===(t.id+1)%n.length),s=n.find(f=>f.id===(l.id-1+n.length)%n.length),h=n.find(f=>f.id===(s.id-1+n.length)%n.length);e.arc.radius=e.arc.hit,l.arc.radius=e.arc.hit,e.locked=!0,l.locked=!0,i-=2,e.offset=e.arc.radius*e.angle.vel,l.offset=l.arc.radius*l.angle.vel,s.out.rest-=l.offset,l.in.rest-=l.offset,l.out.rest-=l.offset,l.out.rest-=e.offset,e.in.rest-=e.offset,e.out.rest-=e.offset,t.in.rest-=e.offset,s.arc.hit=Math.min(s.in.length/(s.angle.vel+h.angle.vel),s.out.rest/s.angle.vel),t.arc.hit=Math.min(t.out.length/(t.angle.vel+a.angle.vel),t.in.rest/t.angle.vel)}else l.locked&&!t.locked&&(e.arc.radius=Math.min(e.in.rest/e.angle.vel,e.out.length/(e.angle.vel+t.angle.vel),e.arc.radius)),t.locked&&!l.locked&&(e.arc.radius=Math.min(e.out.rest/e.angle.vel,e.in.length/(e.angle.vel+l.angle.vel),e.arc.radius)),t.locked&&l.locked&&(e.arc.radius=Math.min(e.in.rest/e.angle.vel,e.out.rest/e.angle.vel,e.arc.radius)),e.offset=e.arc.radius*e.angle.vel,l.out.rest-=e.offset,e.in.rest-=e.offset,e.out.rest-=e.offset,t.in.rest-=e.offset,e.locked=!0,i--;else e.offset=e.arc.radius*e.angle.vel,l.out.rest-=e.offset,e.in.rest-=e.offset,e.out.rest-=e.offset,t.in.rest-=e.offset,e.locked=!0,i--}},_=(e,n)=>e.locked&&!n.locked?1:!e.locked&&n.locked?-1:e.locked&&n.locked?0:e.arc.hit-n.arc.hit;module.exports=y;
